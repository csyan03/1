<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>小明同学</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: none;
        }

        body {
            overflow: hidden;
            font-family: Arial, sans-serif;
            background: #FFFFFF;
        }

        /* 主页样式 */
        .profile {
            position: relative;
            color: black;
            padding: 15px;
        }

        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 10px;
        }

        .stats {
            font-size: 14px;
            margin: 10px 0;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2px;
        }

        .thumbnail {
            aspect-ratio: 3/4;
            background: #FFFFFF;
            position: relative;
        }

        /* 文件夹样式 */
        .folder-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: none;
        }

        .folder {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .carousel {
            display: flex;
            transition: transform 0.3s;
        }

        .media-item {
            flex: 0 0 100%;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        video, img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .date {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: white;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- 主页内容 -->
    <div class="profile">
        <img src="241226-t.jpg" class="avatar" alt="头像">
        <h1>小明同学</h1>
        <div class="stats">
            <span>752获赞</span>
            <span>58关注</span>
            <span>88粉丝</span>
        </div>
        <div class="grid">
            <div class="thumbnail" data-folder="1">
                <img src="250115-0.webp" class="thumb" alt="缩略图">
            </div>
            <div class="thumbnail" data-folder="2">
                <img src="250101-0.webp" class="thumb" alt="缩略图">
            </div>
            <div class="thumbnail" data-folder="3">
                <img src="241215-0.webp" class="thumb" alt="缩略图">
            </div>
        </div>
    </div>

    <!-- 文件夹模板 -->
    <template id="folderTemplate">
        <div class="folder-container">
            <div class="folder">
                <div class="carousel"></div>
                <div class="date"></div>
                <audio class="bgm"></audio>
            </div>
        </div>
    </template>

<script>
const foldersData = {
    1: {
        bgm: "250115.mp3",
        media: ["250115-1.mp4", "250115-2.mp4"]
    },
    2: {
        bgm: "250101.mp3",
        media: ["250101-1.mp4", "250101-2.mp4", "250101-3.mp4", "250101-4.mp4"]
    },
    3: {
        bgm: "241215.mp3",
        media: ["241215-1.mp4", "241215-2.mp4", "241215-3.mp4", "241215-4.webp"]
    }
};

let currentFolder = null;
let currentIndex = 0;

// 初始化缩略图
document.querySelectorAll('.thumbnail').forEach(thumb => {
    thumb.addEventListener('click', () => {
        const folderId = thumb.dataset.folder;
        openFolder(folderId);
    });
});

function openFolder(folderId) {
    const data = foldersData[folderId];
    const template = document.getElementById('folderTemplate');
    const clone = template.content.cloneNode(true);
    const container = clone.querySelector('.folder-container');
    
    // 设置背景音乐
    const bgm = container.querySelector('.bgm');
    bgm.src = data.bgm;
    bgm.loop = true;
    
    // 设置日期
    const dateStr = data.bgm.replace(/(\d{4})(\d{2})(\d{2}).*/, '$1年$2月$3日');
    container.querySelector('.date').textContent = dateStr;

    // 添加媒体内容
    const carousel = container.querySelector('.carousel');
    data.media.forEach(file => {
        const item = document.createElement('div');
        item.className = 'media-item';

        if (file.endsWith('.mp4')) {
            const video = document.createElement('video');
            video.loop = true;
            video.setAttribute('playsinline', 'true'); // 兼容移动端
            video.setAttribute('webkit-playsinline', 'true');
            video.innerHTML = `<source src="${file}" type="video/mp4">`;
            
            // 禁止手动拖动进度条
            video.controls = false;
            video.addEventListener('timeupdate', function () {
                if (this.paused) this.play(); // 防止手动暂停
            });

            item.appendChild(video);
        } else {
            const img = document.createElement('img');
            img.src = file;
            item.appendChild(img);
        }

        carousel.appendChild(item);
    });

    // 添加到页面并显示
    document.body.appendChild(clone);
    container.style.display = 'block';
    currentFolder = container;
    bgm.play();

    // 初始化滑动事件和点击事件
    initSwipe(container);
    initClickHandler(container);
}

function initClickHandler(container) {
    container.addEventListener('touchstart', function (e) {
        const touchY = e.touches[0].clientY;
        const screenHeight = window.innerHeight;

        if (touchY > screenHeight * 0.25 && touchY < screenHeight * 0.75) {
            // 点击中部区域，暂停/播放所有视频
            toggleMediaPlayback(container);
        } else {
            // 点击顶部或底部，关闭文件夹
            closeFolder();
        }
    });
}

function toggleMediaPlayback(container) {
    const videos = container.querySelectorAll('video');
    videos.forEach(video => {
        if (video.paused) {
            video.play();
        } else {
            video.pause();
        }
    });
}

function closeFolder() {
    if (currentFolder) {
        currentFolder.remove();
        currentFolder = null;
        currentIndex = 0;
    }
}
</script>
</body>
</html>
